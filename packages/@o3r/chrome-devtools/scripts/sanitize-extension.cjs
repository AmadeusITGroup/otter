const glob = require('globby');
const { readFile, writeFile } = require('node:fs/promises');
const { resolve } = require('node:path');

/**
 * The Chrome Extension mechanism does not accept exports in loaded module
 * The purpose of this script is to remove the empty `export` generated by TSC
 */
const removeEmptyExports = async () => {
  const dist = resolve(__dirname, '..', 'dist');
  const files = await glob('extension/**/*.js', { cwd: dist });
  for (const fileRelativePath of files) {
    const file = resolve(dist, fileRelativePath);
    let content = await readFile(file, { encoding: 'utf8' });
    content = content.replace(/^export \{\};\r?\n?/mg, '');
    await writeFile(file, content);
  }
};

void removeEmptyExports();
